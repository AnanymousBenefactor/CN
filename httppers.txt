#include <stdio.h>                                                                                                                                                     
#include <stdlib.h>                                                                                                                                                    
#include <string.h>                                                                                                                                                    
#include <unistd.h>                                                                                                                                                    
#include <sys/types.h>                                                                                                                                                 
#include <sys/socket.h>                                                                                                                                                
#include <netinet/in.h>                                                                                                                                                
#include <netdb.h>                                                                                                                                                     
                                                                                                                                                                       
void error(const char *msg)                                                                                                                                            
{                                                                                                                                                                      
    perror(msg);                                                                                                                                                       
    exit(0);                                                                                                                                                           
}                                                                                                                                                                      
                                                                                                                                                                       
int main(int argc, char *argv[])                                                                                                                                       
{                                                                                                                                                                      
    int sockfd, portno, n;                                                                                                                                             
    struct sockaddr_in serv_addr;                                                                                                                                      
    struct hostent *server;                                                                                                                                            
                                                                                                                                                                       
    char buffer[256];                                                                                                                                                  
    if (argc < 3)                                                                                                                                                      
    {                                                                                                                                                                  
        fprintf(stderr, "usage %s hostname port\n", argv[0]);                                                                                                          
        exit(0);                                                                                                                                                       
    }                                                                                                                                                                  
    portno = atoi(argv[2]);                                                                                                                                            
    sockfd = socket(AF_INET, SOCK_STREAM, 0);                                                                                                                          
    if (sockfd < 0)                                                                                                                                                    
        error("ERROR opening socket");                                                                                                                                 
    server = gethostbyname(argv[1]);                                                                                                                                   
    if (server == NULL)                                                                                                                                                
    {                                                                                                                                                                  
        fprintf(stderr, "ERROR, no such host\n");                                                                                                                      
        exit(0);                                                                                                                                                       
    }                                                                                                                                                                  
    bzero((char *)&serv_addr, sizeof(serv_addr));                                                                                                                      
    serv_addr.sin_family = AF_INET;                                                                                                                                    
    bcopy((char *)server->h_addr,                                                                                                                                      
          (char *)&serv_addr.sin_addr.s_addr,                                                                                                                          
          server->h_length);                                                                                                                                           
    serv_addr.sin_port = htons(portno);                                                                                                                                
    if (connect(sockfd, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0)                                                                                         
        error("ERROR connecting");                                                                                                                                     
                                                                                                                                                                       
    while (1) {                                                                                                                                                        
        printf("Please enter the message: ");                                                                                                                          
        bzero(buffer, 256);                                                                                                                                            
        fgets(buffer, 255, stdin);                                                                                                                                     
        n = write(sockfd, buffer, strlen(buffer));                                                                                                                     
        if (n < 0)                                                                                                                                                     
                error("ERROR writing to socket");                                                                                                                      
        bzero(buffer, 256);                                                                                                                                            
        n = read(sockfd, buffer, 255);                                                                                                                                 
        if (n < 0)                                                                                                                                                     
                error("ERROR reading from socket");                                                                                                                    
        printf("Server Response %s\n", buffer);                                                                                                                        
    }                                                                                                                                                                  
    close(sockfd);                                                                                                                                                     
    return 0;                                                                                                                                                          
}        

client.c
#include <stdio.h>                                                                                                                                                     
#include <stdlib.h>                                                                                                                                                    
#include <string.h>                                                                                                                                                    
#include <unistd.h>                                                                                                                                                    
#include <sys/types.h>                                                                                                                                                 
#include <sys/socket.h>                                                                                                                                                
#include <netinet/in.h>                                                                                                                                                
#include <netdb.h>                                                                                                                                                     
                                                                                                                                                                       
void error(const char *msg)                                                                                                                                            
{                                                                                                                                                                      
    perror(msg);                                                                                                                                                       
    exit(0);                                                                                                                                                           
}                                                                                                                                                                      
                                                                                                                                                                       
int main(int argc, char *argv[])                                                                                                                                       
{                                                                                                                                                                      
    int sockfd, portno, n;                                                                                                                                             
    struct sockaddr_in serv_addr;                                                                                                                                      
    struct hostent *server;                                                                                                                                            
                                                                                                                                                                       
    char buffer[256];                                                                                                                                                  
    if (argc < 3)                                                                                                                                                      
    {                                                                                                                                                                  
        fprintf(stderr, "usage %s hostname port\n", argv[0]);                                                                                                          
        exit(0);                                                                                                                                                       
    }                                                                                                                                                                  
    portno = atoi(argv[2]);                                                                                                                                            
    sockfd = socket(AF_INET, SOCK_STREAM, 0);                                                                                                                          
    if (sockfd < 0)                                                                                                                                                    
        error("ERROR opening socket");                                                                                                                                 
    server = gethostbyname(argv[1]);                                                                                                                                   
    if (server == NULL)                                                                                                                                                
    {                                                                                                                                                                  
        fprintf(stderr, "ERROR, no such host\n");                                                                                                                      
        exit(0);                                                                                                                                                       
    }                                                                                                                                                                  
    bzero((char *)&serv_addr, sizeof(serv_addr));                                                                                                                      
    serv_addr.sin_family = AF_INET;                                                                                                                                    
    bcopy((char *)server->h_addr,                                                                                                                                      
          (char *)&serv_addr.sin_addr.s_addr,                                                                                                                          
          server->h_length);                                                                                                                                           
    serv_addr.sin_port = htons(portno);                                                                                                                                
    if (connect(sockfd, (struct sockaddr *)&serv_addr, sizeof(serv_addr)) < 0)                                                                                         
        error("ERROR connecting");                                                                                                                                     
                                                                                                                                                                       
    while (1) {                                                                                                                                                        
        printf("Please enter the message: ");                                                                                                                          
        bzero(buffer, 256);                                                                                                                                            
        fgets(buffer, 255, stdin);                                                                                                                                     
        n = write(sockfd, buffer, strlen(buffer));                                                                                                                     
        if (n < 0)                                                                                                                                                     
                error("ERROR writing to socket");                                                                                                                      
        bzero(buffer, 256);                                                                                                                                            
        n = read(sockfd, buffer, 255);                                                                                                                                 
        if (n < 0)                                                                                                                                                     
                error("ERROR reading from socket");                                                                                                                    
        printf("Server Response %s\n", buffer);                                                                                                                        
    }                                                                                                                                                                  
    close(sockfd);                                                                                                                                                     
    return 0;                                                                                                                                                          
}     



nperclient.c
#include <stdlib.h>                                                                                                                                                    
#include <stdio.h>                                                                                                                                                     
#include <errno.h>                                                                                                                                                     
#include <string.h>                                                                                                                                                    
#include <sys/types.h>                                                                                                                                                 
#include <netinet/in.h>                                                                                                                                                
#include <sys/wait.h>                                                                                                                                                  
#include <sys/socket.h>                                                                                                                                                
#include <signal.h>                                                                                                                                                    
#include <ctype.h>                                                                                                                                                     
#include <arpa/inet.h>                                                                                                                                                 
#include <unistd.h>                                                                                                                                                    
#include <netdb.h>                                                                                                                                                     
#define LENGTH 512                                                                                                                                                     
                                                                                                                                                                       
int main(int argc, char *argv[]) {                                                                                                                                     
        int sockfd, PORT, rcv_bytes = 0;                                                                                                                               
        struct sockaddr_in serv_addr;                                                                                                                                  
        if ((sockfd = socket(AF_INET, SOCK_STREAM, 0)) < 0 ) {                                                                                                         
                perror("Socket Failed!");                                                                                                                              
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        memset(&serv_addr, '0', sizeof(serv_addr));                                                                                                                    
        PORT = atoi(argv[2]);                                                                                                                                          
        serv_addr.sin_family = AF_INET;                                                                                                                                
        serv_addr.sin_port = htons(PORT);                                                                                                                              
        if(inet_pton(AF_INET, argv[1], &serv_addr.sin_addr) < 0) {                                                                                                     
                perror("Invalid Address or Address is in use!");                                                                                                       
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        bzero(&(serv_addr.sin_zero), 8);                                                                                                                               
        if (connect(sockfd, (struct sockaddr *)&serv_addr, sizeof(struct sockaddr)) < 0) {                                                                             
                perror("Connection Failed !");                                                                                                                         
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        printf("Connected Established at port %d... Ok!\n", PORT);                                                                                                     
        printf("Enter the Filename or Type 'q' to exit\n");                                                                                                            
        char file_name[10000];                                                                                                                                         
        scanf ("%s", file_name);                                                                                                                                       
        printf("%s\n",file_name);                                                                                                                                      
        if(file_name[0] == 'q') {                                                                                                                                      
                close (sockfd);                                                                                                                                        
                printf("Connection lost. => {Client}\n");                                                                                                              
                return 0;                                                                                                                                              
        }                                                                                                                                                              
        send(sockfd , file_name, strlen(file_name), 0);                                                                                                                
        char *rcv_buffer;                                                                                                                                              
        rcv_buffer = (char *) malloc(LENGTH*sizeof(char));                                                                                                             
        char signal_msg[LENGTH];                                                                                                                                       
        int valread;                                                                                                                                                   
        memset(signal_msg,0,sizeof(signal_msg));                                                                                                                       
        valread = read(sockfd, signal_msg,LENGTH);                                                                                                                     
        signal_msg[1] = '\0';                                                                                                                                          
        printf("%s\n", signal_msg);                                                                                                                                    
        if(signal_msg[0] == 'n') {                                                                                                                                     
                printf("File not Found on server !\n");                                                                                                                
        }                                                                                                                                                              
        else {                                                                                                                                                         
                printf("File found on server\n");                                                                                                                      
                printf("Receiveing file from Server ....\n");                                                                                                          
                FILE *file_pointer = fopen(file_name, "w");                                                                                                            
                if(file_pointer == NULL) {                                                                                                                             
                        printf("File %s Cannot be opened.\n", file_name);                                                                                              
                        exit(EXIT_FAILURE);                                                                                                                            
                }                                                                                                                                                      
                memset(rcv_buffer,'0',sizeof(rcv_buffer));                                                                                                             
                while((rcv_bytes = read(sockfd, rcv_buffer, LENGTH)) > 0) {                                                                                            
                        if((fwrite(rcv_buffer, sizeof(char), rcv_bytes, file_pointer)) < rcv_bytes) {                                                                  
                                perror("File write failed! ");                                                                                                         
                                exit(EXIT_FAILURE);                                                                                                                    
                        }                                                                                                                                              
                        printf("\n contents of the file \n");                                                                                                          
                        printf("%s\n", rcv_buffer);                                                                                                                    
                        memset(rcv_buffer,'0',sizeof(rcv_buffer));                                                                                                     
                        if (rcv_bytes != LENGTH) {                                                                                                                     
                                break;                                                                                                                                 
                        }                                                                                                                                              
                }                                                                                                                                                      
                if(rcv_bytes < 0 && errno == EAGAIN) {                                                                                                                 
                        printf("Connection time out!\n");                                                                                                              
                        fclose(file_pointer);                                                                                                                          
                }                                                                                                                                                      
                else if(rcv_bytes < 0 && errno != EAGAIN) {                                                                                                            
                        fprintf(stderr, "recv() failed due to errno = %d\n", errno);                                                                                   
                        fclose(file_pointer);                                                                                                                          
                }                                                                                                                                                      
                else {                                                                                                                                                 
                        free(rcv_buffer);                                                                                                                              
                        printf("File recieved successfully!\n");                                                                                                       
                        fclose(file_pointer);                                                                                                                          
                }                                                                                                                                                      
        }                                                                                                                                                              
        close (sockfd);                                                                                                                                                
        printf("Connection lost. => {Client}\n");                                                                                                                      
        return (0);                                                                                                                                                    
}                                            

npserver
#include <stdio.h>                                                                                                                                                     
#include <signal.h>                                                                                                                                                    
#include <arpa/inet.h>                                                                                                                                                 
#include <string.h>                                                                                                                                                    
#include <sys/socket.h>                                                                                                                                                
#include <errno.h>                                                                                                                                                     
#include <sys/wait.h>                                                                                                                                                  
#include <ctype.h>                                                                                                                                                     
#include <netdb.h>                                                                                                                                                     
#include <unistd.h>                                                                                                                                                    
#include <stdlib.h>                                                                                                                                                    
#include <netinet/in.h>                                                                                                                                                
#include <sys/types.h>                                                                                                                                                 
#include <fcntl.h>                                                                                                                                                     
                                                                                                                                                                       
#define LENGTH 512                                                                                                                                                     
                                                                                                                                                                       
int main (int argc, char *argv[]) {                                                                                                                                    
        int server_fd, newsocket, valread, rcv_bytes, PORT;                                                                                                            
        struct sockaddr_in addr_local;                                                                                                                                 
        struct sockaddr_in addr_remote;                                                                                                                                
        int addrlen = sizeof(struct sockaddr_in);                                                                                                                      
        if((server_fd = socket(AF_INET, SOCK_STREAM, 0)) == 0 ) {                                                                                                      
                perror("Socket failed!");                                                                                                                              
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        printf("Socket Descriptor obtained successfully. => {Server}\n");                                                                                              
        PORT = atoi(argv[1]);                                                                                                                                          
        addr_local.sin_family = AF_INET;                                                                                                                               
        addr_local.sin_addr.s_addr = INADDR_ANY;                                                                                                                       
        addr_local.sin_port = htons(PORT);                                                                                                                             
        bzero(&(addr_local.sin_zero), 8);                                                                                                                              
        if(bind(server_fd, (struct sockaddr*)&addr_local, sizeof(addr_local)) < 0) {                                                                                   
                perror("Binding Socket to the PORT failed!");                                                                                                          
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        printf("PORT %d of TCP Connection Binded Sucessfully. => {Server} \n", PORT);                                                                                  
        if(listen(server_fd, 10) < 0) {                                                                                                                                
                perror("Listening to the Connection Failed!");                                                                                                         
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        printf ("Listening the PORT %d OK => {Server}.\n", PORT);                                                                                                      
        if ((newsocket = accept(server_fd, (struct sockaddr *)NULL, NULL)) < 0) {                                                                                      
                perror("Error in Connection");                                                                                                                         
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        printf("Connection Established from %s. => {Server} \n", inet_ntoa(addr_remote.sin_addr));                                                                     
        char dir[10000], cwd[1000];                                                                                                                                    
        char *rcv_buffer;                                                                                                                                              
        rcv_buffer = (char *) malloc(LENGTH*sizeof(char));                                                                                                             
        bzero(dir,10000);                                                                                                                                              
        valread = read(newsocket, dir, LENGTH);                                                                                                                        
        int j = strlen(dir);                                                                                                                                           
        dir[j] = '\0';                                                                                                                                                 
        getcwd(cwd,sizeof(cwd));                                                                                                                                       
        strcat(cwd,"/data/");                                                                                                                                          
        strcat(cwd,dir);                                                                                                                                               
        if(dir[0] == 'q') {                                                                                                                                            
                close(newsocket);                                                                                                                                      
                sleep(2.3);                                                                                                                                            
                printf("Connection with client closes.\n");                                                                                                            
        }                                                                                                                                                              
        if(valread < 0) {                                                                                                                                              
                perror("Error in reading path of file from client");                                                                                                   
                exit(EXIT_FAILURE);                                                                                                                                    
        }                                                                                                                                                              
        FILE *fs = fopen(cwd, "r");                                                                                                                                    
        memset(cwd,0,sizeof(cwd));                                                                                                                                     
        if(fs == NULL) {                                                                                                                                               
                send(newsocket,"n", strlen("n"),0);                                                                                                                    
        }                                                                                                                                                              
        else {                                                                                                                                                         
                printf("%s Sending to the Client... => {Server}\n", dir);                                                                                              
                send(newsocket,"y", strlen("y"),0);                                                                                                                    
                bzero(rcv_buffer, LENGTH);                                                                                                                             
                while((rcv_bytes = fread(rcv_buffer, sizeof(char), LENGTH, fs))>0) {                                                                                   
                        int send_bytes = send(newsocket, rcv_buffer, rcv_bytes, 0);                                                                                    
                        if(send_bytes < 0) {                                                                                                                           
                                perror("Failed to send file !");                                                                                                       
                                exit(EXIT_FAILURE);                                                                                                                    
                        }                                                                                                                                              
                        memset(rcv_buffer,'0',sizeof(rcv_buffer));                                                                                                     
                        if(feof(fs)) {                                                                                                                                 
                                free(rcv_buffer);                                                                                                                      
                                break;                                                                                                                                 
                        }                                                                                                                                              
                }                                                                                                                                                      
                printf("File sent successfully!\n");                                                                                                                   
        }                                                                                                                                                              
        close(newsocket);                                                                                                                                              
        sleep(2.3);                                                                                                                                                    
        printf("Connection lost. => {Server}\n");                                                                                                                      
        close(server_fd);                                                                                                                                              
        return 0;                                                                                                                                                      
}                                
